<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- favicon and web app manifest -->
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="favicon.svg">
  <meta name="theme-color" content="#2c3e50">
  <title>Ù…Ø±ÙƒØ² Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª â€” Ø¯Ø±ÙˆØ³</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <link rel="stylesheet" href="styles.css">
  <style>
    body { background: #fffcff; color: #333; min-height: 100vh; display: flex; flex-direction: column; }
    
    /* Header styling - preserve original design */
    header { 
      background: rgb(77, 14, 99);
      padding: 8px 20px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.6);
      margin-bottom: 20px;
    }
    .header-inner { 
      display: flex;
      align-items: center;
      gap: 14px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .logo { 
      height: 50px;
      width: auto;
    }
    .header-title { 
      margin: 0;
      font-size: 1.5rem;
      color: var(--primary);
    }
    
    .help-layout { max-width: 900px; margin: 40px auto; padding: 0 20px; flex: 1; }
    .main { width: 100%; }
    .side { display: none; }
    .tabs { display: none; }
    .card { background: #ffffff; padding: 0; border-radius: 0; box-shadow: none; border: none; transition: none; }
    .card:hover { transform: none; box-shadow: none; }
    h2 { color: #2c3e50; }
    #tutorials-section { padding: 0; }
    #tutorials-section > div:first-child { display: none; }
    #add-form { margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; }
    form input, form textarea { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd; background: #fff; color: #000; margin-bottom: 10px; }
    .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; background: #007bff; color: #fff; }
    #tutorialsList { display: flex; flex-direction: column; gap: 0; }
    .faq-item { border-bottom: 1px solid #e5e5e5; padding: 18px 0; cursor: pointer; }
    .faq-item:last-child { border-bottom: none; }
    .faq-header { display: flex; justify-content: space-between; align-items: center; }
    .faq-question { margin: 0; font-size: 16px; font-weight: 500; color: #333; }
    .faq-icon { font-size: 18px; color: #666; transition: transform 0.3s ease; }
    .faq-item.expanded .faq-icon { transform: rotate(180deg); }
    .tutorial-details { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; padding: 0; }
    .faq-item.expanded .tutorial-details { max-height: 2000px; padding-top: 15px; }
    .tutorial-details { display: flex; gap: 20px; align-items: flex-start; flex-direction: row-reverse; }
    .tutorial-details p { color: #666; line-height: 1.6; margin: 10px 0; }
    .tutorial-details img { min-width: 200px; max-width: 200px; height: auto; border-radius: 8px; flex-shrink: 0; }
    .tutorial-details > div:last-child { flex: 1; }
    .tutorial-details h1, .tutorial-details h2, .tutorial-details h3 { color: #2c3e50; margin-top: 15px; margin-bottom: 10px; }
    .tutorial-details ul, .tutorial-details ol { padding-right: 20px; color: #666; line-height: 1.8; }
    .tutorial-details li { margin: 8px 0; }
    .tutorial-details strong { color: #2c3e50; font-weight: 700; }
    .tutorial-details em { font-style: italic; color: #555; }
    .tutorial-details blockquote { border-right: 4px solid #007bff; padding-right: 12px; margin: 15px 0; color: #666; background: #f5f5f5; padding: 12px; border-radius: 6px; }
    .tutorial-details code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; font-family: 'Courier New'; color: #d63384; }
    .tutorial-details pre { background: #2c3e50; color: #fff; padding: 12px; border-radius: 6px; overflow-x: auto; }
    .tutorial-details a { color: #007bff; text-decoration: none; }
    .tutorial-details a:hover { text-decoration: underline; }
    .btn-accent { background: #007bff; color: #fff; padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; margin-top: 10px; }
    .ocr-spinner { width:18px; height:18px; border:3px solid rgba(0,0,0,0.12); border-top-color: #007bff; border-radius:50%; display:none; animation:spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <img id="siteLogo" class="logo" src=";utf8, <svg xmlns='http://www.w3.org/2000/svg' width='48' height='48'><rect fill='%232c3e50' width='100%25' height='100%25'/><text x='50%25' y='50%25' font-size='22' fill='%23ffffff' dominant-baseline='middle' text-anchor='middle'>M</text></svg>" alt="logo">
      <h1 class="header-title">Ù…Ø±ÙƒØ² Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙˆØ§Ù„Ø¯Ø¹Ù…</h1>
      <button id="menu-toggle" class="menu-toggle" aria-label="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <nav class="main-nav" id="main-nav" aria-label="Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹">
        <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="#">Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙˆØ§Ù„Ø¯Ø¹Ù…</a>
        <a href="#">Ø§Ù„Ø¹Ø±ÙˆØ¶</a>
        <a href="#">ØªÙˆØ§ØµÙ„</a>
      </nav>
    </div>
  </header>
  <script>
    const menuToggle = document.getElementById('menu-toggle');
    const mainNav = document.getElementById('main-nav');
    menuToggle.addEventListener('click', () => {
      mainNav.classList.toggle('active');
      menuToggle.classList.toggle('active');
    });
    mainNav.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        mainNav.classList.remove('active');
        menuToggle.classList.remove('active');
      });
    });
  </script>

  <div class="container help-layout">
    <main class="main">
      <section id="tutorials-section" class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <h2 style="margin:0">Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª!!!</h2>
        </div>

        <div style="margin-bottom:12px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
          <div style="position:relative; flex:1;">
            <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø©..." style="width:100%; padding:12px 44px 12px 12px; border:2px solid #ddd; border-radius:8px; font-size:16px; background:#fff; box-sizing:border-box;">
            <button id="imgSearchButtonTutorials" aria-label="Ø§Ù„ØªÙ‚Ø§Ø·/Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø©" style="position:absolute; left:8px; top:50%; transform:translateY(-50%); border:none; background:transparent; cursor:pointer; width:32px; height:32px; display:flex; align-items:center; justify-content:center; padding:0;">
              <!-- replace svg with external image file; place the attached file at img/camera-icon.png -->
              <img id="cameraIconTutorials" src="photocameraoutline_80020.png" alt="camera" style="width:18px;height:18px;display:block;">
            </button>
            <input type="file" id="imgSearchInputTutorials" accept="image/*" style="display:none;">
            <div id="ocrSpinnerTutorials" class="ocr-spinner" title="Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©..." style="position:absolute; left:46px; top:50%; transform:translateY(-50%); display:none;"></div>
            <button id="clearTextTutorials" aria-label="Ù…Ø³Ø­ Ø§Ù„Ù†Øµ" style="position:absolute; right:8px; top:50%; transform:translateY(-50%); border:none; background:transparent; cursor:pointer; font-size:18px; line-height:1; display:none;">Ã—</button>
          </div>
          <label style="display:flex;align-items:center;gap:8px;">Ù„ØºØ© OCR:
            <select id="ocrLangSelectTutorials" style="padding:6px;border-radius:6px;border:1px solid #ddd;background:#fff;display:none;">
              <option value="ara">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)</option>
              <option value="eng">English</option>
              <option value="ara+eng" selected>Arabic + English</option>
              <option value="spa+por+fra">Spanish/Portuguese/French</option>
              <option value="all">All common languages (may be slow)</option>
            </select>
          </label>
          <button id="imgSearchClearTutorials" style="display:none;padding:8px;border-radius:8px;border:1px solid #ddd;background:#fff;">Ù…Ø³Ø­</button>
        </div>

        <div id="tutorialsList"></div>
      </section>
    </main>
  </div>

  <script>
    // Firebase config (Ù…ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ index.html)
    const firebaseConfig = {
      apiKey: "AIzaSyDdLB3KHZVbNw3O9QrKJzBw2pL_pFn8Iso",
      databaseURL: "https://mazen-2ba04-default-rtdb.firebaseio.com",
      projectId: "mazen-2ba04"
    };
    if(!window.firebase || !firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const md = window.markdownit();

    // Ø¹Ù†Ø§ØµØ±
    const tutorialsList = document.getElementById('tutorialsList');
    const searchInput = document.getElementById('searchInput');
    let allTutorials = [];

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆØ³ Ù…Ù† Firebase
    function renderTutorialCard(key, data){
      const wrapper = document.createElement('div'); wrapper.className = 'faq-item';
      wrapper.dataset.title = (data.title || '').toLowerCase();
      wrapper.dataset.content = (data.content || '').toLowerCase();

      const header = document.createElement('div'); header.className = 'faq-header';
      const question = document.createElement('h3'); question.className = 'faq-question'; question.innerText = data.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
      const icon = document.createElement('span'); icon.className = 'faq-icon'; icon.innerHTML = '&#9662;';
      header.appendChild(question); header.appendChild(icon);
      
      const details = document.createElement('div'); details.className = 'tutorial-details';
      
      // Create a wrapper for image and content in side-by-side layout
      const contentWrapper = document.createElement('div');
      
      if(data.thumb){
        const img = document.createElement('img'); img.src = data.thumb; img.alt = data.title || '';
        details.appendChild(img);
      }
      
      const content = document.createElement('div');
      content.innerHTML = data.content || '';
      details.appendChild(content);

      header.addEventListener('click', () => { wrapper.classList.toggle('expanded'); });
      
      wrapper.appendChild(header);
      wrapper.appendChild(details);
      return wrapper;
    }

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¨Ø­Ø«
    function filterTutorials() {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const items = tutorialsList.querySelectorAll('.faq-item');
      
      items.forEach(item => {
        const title = item.dataset.title || '';
        const content = item.dataset.content || '';
        
        if (title.includes(searchTerm) || content.includes(searchTerm)) {
          item.style.display = '';
        } else {
          item.style.display = 'none';
        }
      });
    }

    // Ø±Ø¨Ø· Ø­Ø¯Ø« Ø§Ù„Ø¨Ø­Ø«
    if (searchInput) {
      searchInput.addEventListener('input', filterTutorials);
    }

    db.ref('help/tutorials').once('value').then(snap => {
      const val = snap.val() || {};
      const fragment = document.createDocumentFragment();
      tutorialsList.innerHTML = '';
      allTutorials = [];
      Object.keys(val).reverse().forEach(k => {
        const el = renderTutorialCard(k, val[k]);
        fragment.appendChild(el);
        allTutorials.push({ key: k, data: val[k], element: el });
      });
      tutorialsList.appendChild(fragment);
      // compute aHash for tutorial thumbnails (8x8 aHash)
      function toGrayscaleAndResize(img, size) {
        size = size || 8;
        const c = document.createElement('canvas');
        c.width = size; c.height = size;
        const ctx = c.getContext('2d');
        try {
          ctx.drawImage(img, 0, 0, size, size);
          const d = ctx.getImageData(0, 0, size, size).data;
          const pixels = [];
          for (let i = 0; i < d.length; i += 4) {
            const r = d[i], g = d[i+1], b = d[i+2];
            pixels.push(Math.round((r + g + b) / 3));
          }
          return pixels;
        } catch (err) { return null; }
      }

      function computeAHashFromImageElement(imgEl) {
        const pixels = toGrayscaleAndResize(imgEl, 8);
        if (!pixels) return null;
        const avg = pixels.reduce((a,b)=>a+b,0)/pixels.length;
        return pixels.map(v=> v>avg ? '1' : '0').join('');
      }

      function hamming(a,b){ if(!a||!b) return 999; let cnt=0; for(let i=0;i<Math.min(a.length,b.length);i++) if(a[i]!==b[i]) cnt++; return cnt; }

      const tutorialThumbs = Array.from(document.querySelectorAll('.tutorial-details img'));
      tutorialThumbs.forEach(img => {
        if(img.complete && img.naturalWidth){ const h = computeAHashFromImageElement(img); if(h) img.dataset.ahash = h; }
        else img.addEventListener('load', ()=>{ const h = computeAHashFromImageElement(img); if(h) img.dataset.ahash = h; });
      });

      // image-search handlers for tutorials
      const imgSearchInputTutorials = document.getElementById('imgSearchInputTutorials');
      const imgSearchClearTutorials = document.getElementById('imgSearchClearTutorials');
      const imgSearchStatusTutorials = document.getElementById('imgSearchStatusTutorials');
      const ocrSpinnerTutorials = document.getElementById('ocrSpinnerTutorials');
      const imgSearchButtonTutorials = document.getElementById('imgSearchButtonTutorials');
      const clearTextTutorials = document.getElementById('clearTextTutorials');

      if (imgSearchInputTutorials) {
        imgSearchInputTutorials.addEventListener('change', (ev)=>{
          const file = ev.target.files && ev.target.files[0]; if(!file) return;
          if (ocrSpinnerTutorials) ocrSpinnerTutorials.style.display = 'inline-block';
          const url = URL.createObjectURL(file);
          const uploaded = new Image(); uploaded.crossOrigin = 'Anonymous';

          uploaded.onload = ()=>{
            // Attempt OCR first (Arabic preferred), fallback to image-hash comparison
            if (ocrSpinnerTutorials) ocrSpinnerTutorials.style.display = 'inline-block';
            if (window.Tesseract && typeof Tesseract.recognize === 'function') {
              // determine language string from selector
              const langSelect = document.getElementById('ocrLangSelectTutorials');
              let langStr = 'ara';
              if (langSelect) {
                const v = langSelect.value || 'ara';
                if (v === 'all') {
                  // a balanced set of common languages; loading may be slow
                  langStr = 'eng+ara+spa+fra+deu+ita+por+rus+chi_sim+chi_tra+jpn+kor+hin+tur+vie';
                } else {
                  langStr = v;
                }
              }

              Tesseract.recognize(file, langStr)
                .then(res => {
                  const text = res && res.data && res.data.text ? res.data.text.trim() : '';
                  if (text && text.length > 2) {
                    searchInput.value = text;
                    filterTutorials();
                    if (ocrSpinnerTutorials) ocrSpinnerTutorials.style.display = 'none';
                    URL.revokeObjectURL(url);
                    return;
                  }
                  // no useful text -> fallback to hash matching
                  if (ocrSpinnerTutorials) ocrSpinnerTutorials.style.display = 'inline-block';
                  performHashMatch(uploaded, url);
                })
                .catch(err => {
                  if (ocrSpinnerTutorials) ocrSpinnerTutorials.style.display = 'inline-block';
                  performHashMatch(uploaded, url);
                });
            } else {
              // Tesseract not available: do hash matching
              if (ocrSpinnerTutorials) ocrSpinnerTutorials.style.display = 'inline-block';
              performHashMatch(uploaded, url);
            }
          };

          uploaded.onerror = ()=>{ URL.revokeObjectURL(url); imgSearchStatusTutorials.innerText='Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©'; };
          uploaded.src = url;

          function performHashMatch(uploadedImg, objUrl) {
            const pixels = toGrayscaleAndResize(uploadedImg,8);
            URL.revokeObjectURL(objUrl);
            if(!pixels){ if (ocrSpinnerTutorials) ocrSpinnerTutorials.style.display = 'none'; return; }
            const avg = pixels.reduce((a,b)=>a+b,0)/pixels.length;
            const h = pixels.map(v=> v>avg ? '1' : '0').join('');

            const thumbs = Array.from(document.querySelectorAll('.tutorial-details img'));
            const results = thumbs.map(t=> ({ imgEl: t, dist: hamming(h, t.dataset.ahash || null) })).sort((a,b)=>a.dist-b.dist);

            const threshold = 12;
            const matches = results.filter(r => typeof r.dist === 'number' && r.dist <= threshold);

            const items = Array.from(document.querySelectorAll('.faq-item'));
            items.forEach(it => it.style.display = 'none');

            if(matches.length === 0){
              const top = results.slice(0,6).map(r=> r.imgEl.closest('.faq-item')).filter(Boolean);
              top.forEach(c => c.style.display = '');
            } else {
              matches.forEach(r=>{ const c = r.imgEl.closest('.faq-item'); if(c) c.style.display = ''; });
            }
            if (ocrSpinnerTutorials) ocrSpinnerTutorials.style.display = 'none';
          }
        });
      }

      // camera button opens the hidden file input
      if (imgSearchButtonTutorials && imgSearchInputTutorials) {
        imgSearchButtonTutorials.addEventListener('click', (e) => { e.preventDefault(); imgSearchInputTutorials.click(); });
      }

      // clear (Ã—) button for search input
      if (clearTextTutorials) {
        clearTextTutorials.addEventListener('click', (e) => {
          e.preventDefault(); if (searchInput) { searchInput.value = ''; filterTutorials(); clearTextTutorials.style.display = 'none'; }
          if (imgSearchInputTutorials) imgSearchInputTutorials.value = '';
        });
      }

      // show/hide clear button depending on text
      if (searchInput) {
        searchInput.addEventListener('input', () => {
          if (clearTextTutorials) clearTextTutorials.style.display = searchInput.value.trim() ? 'inline-block' : 'none';
        });
      }

      if (imgSearchClearTutorials) imgSearchClearTutorials.addEventListener('click', ()=>{ document.querySelectorAll('.faq-item').forEach(c=> c.style.display=''); if(imgSearchInputTutorials) imgSearchInputTutorials.value=''; if(imgSearchStatusTutorials) imgSearchStatusTutorials.innerText=''; });
    }).catch(err => console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆØ³:', err));

    // ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ¬Ùˆ Ù…Ù† DB Ø¥Ù† ÙˆÙØ¬Ø¯
    db.ref('homepage/logo').once('value').then(snap=>{ const v = snap.val(); if(v && v.data){ const el = document.getElementById('siteLogo'); if(el) el.src = v.data; }}).catch(()=>{});
  </script>

<footer style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; text-align: center; padding: 15px 20px; margin-top: 30px; border-top: 3px solid #667eea;">
    <div style="max-width: 900px; margin: 0 auto;">
        <p style="margin: 5px 0; font-size: 0.95rem; font-weight: 600;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2026</p>
        <p style="margin: 5px 0; font-size: 0.9rem; opacity: 0.9;">mazenalgarne</p>
    </div>
</footer>

</body>
</html>
